10 从漏斗架构到Scrum看板（#09）

10.1 介绍

本文描述了DevOps环境中的一些关于需求的最佳实践。在本文使用的术语可能和因特网或是其它方法定义的不同。原因在于这些术语没有很明确的定义，但是由于这些术语对最佳实践文章具有非常大的意义，因此这些术语在开始写作之前就已经提前定义好了。事实证明，这些术语很容易嵌入到工具中且易于学习。

10.2 术语

主题

主题描述了一个交付敏捷项目的创新。一个主题可以对照于一个项目，并且包含一个以上的史诗。主题的生命周期来自于漏斗模型（参阅文章 #07）。

史诗

史诗是对包含多个DevOps周期的功能块的描述。史诗常用于定义路标。史诗是一个主题的基石，被分解成为特性。一个史诗可以类比为一个项目的阶段计划。

功能

一个特性是对一块功能的描述，该功能不应该超过半个DevOps周期时间。根据业务描述功能。特性和史诗在故事当中是有区别的，特性是史诗的基石。

故事

故事是要实现对象的技术描述或是对象的配置 。一个故事相当于一个变更请求（RFC）。

用户故事

用户故事是一种描述主题、史诗或是特性的协议。用户故事的格式如下：

        我作为 <角色>

        想要 <需要>

        因此 <增加价值>

需求

需求是对信息、应用、基础架构对象或是服务强加的要求。需求可以是功能性需求或是质量性需求。质量需求也称作为非功能性需求（NFR）。

测试类型

下列的测试类型经常被使用：

·      UT = 单元测试

·      ST = 系统测试

·      SIT = 系统集成测试 

·      FAT = 功能验收测试

·      PAT = 生产验收测试

·      PST = 性能压力测试

10.3   概念

可追溯性

DevOps 是一种可以加快产品进入市场的方法。对于关键的业务服务，重要的是要快速定位故障以及如何修复它，然而回退到以前的版本并不总是合适的或是可取的。因此可追溯性的概念与DevOps关系非常大。

可追溯性的意思是当一个在生产环境当中的事件必须可追踪到原有的功能或特性变更当中。

这就要求：

·       在生产环境当中的对象具有唯一标识（ID）。

·       生成的事件包含元数据，提供了对事件源的对象ID的即时洞察 （参阅文章 #06**）。

·       每个惟一标识符的知识在上次修改时保存（构建ID）。

·       在每个构建中，底层的源文件是可识别的。

·       在所有源数据文件中，很清楚哪些静态需求是适用的，以及这些源文件对应的测试结果是什么。

·       需求总是与一个特性联系在一起，并且适用于史诗和主题。

这种形式的可追溯性指的是向后追溯性。或者，如果需求发生变化，可以使用前向跟踪来确定哪些对象需要修改。

可重用性

对于一个组织来说，功能的重用非常重要，因为它节省了大量的时间。此外，功能的重用对质量控制也很重要，因为现有的对象通常比新对象更稳定。通过提供元数据要求，它们更容易检测和使用。

10.4 最佳实践

开始DevOps的旅程首先得学习其基本原理。在一段时间之后，通过人们的不断学习而让DevOps流程更加成熟。这是一个自然的工作，可以被定义为自底向上的每个DevOps团队找到的路径。这是一个非常好的自学的例子。即使一些组织机构不再有直线经理。另外一种方法是从架构的角度来看待 DevOps组织的形成。我们在那里结束？定义一个粗略的目标架构的好处是我们可以定义过渡计划和里程碑。它们并没有精雕细刻，只是粗略的描述，因此每个DevOps的团队在他们各自的行程当中依旧有他们自己的学习曲线。但是重要的风险可以得到很好的管理，投资可以有更好的前瞻性。在这个案例当中，主要关注于信息架构围绕着DevOps团队标题“可追溯性”，目的是为了阻止信息债务。

10.4.1	生命周期管理

需求的生命周期开始于在漏斗方法当中建立一个主题，在那个时候功能和质量需求还没有成形。主题通常不以用户故事的形式来描述。在产品路线图的起草过程当中，功能和质量需求变为更具体。然后把主题分解成史诗。功能和质量需求以用户故事的特点和格式来表达。然而，产品特性只描述可交付成果的业务术语。最后，翻译成故事可以提供机会来陈述技术需求。

10.4.2  功能和技术设计

这些筛选过的功能符合验收标准，可用于创建功能验收测试和单元验收测试的测试计划。由于这些功能是以业务术语制定的，因此它们不适合形成生产验收测试的测试计划。因此，特性需要分解成故事。

认识到特性不适合替换功能设计是很重要的。另外，故事也不能取代技术设计。有时候一个特性是指一个功能设计，而故事则是参考一个技术设计。但是，这不是推荐的方法，因为工具中描述的特性/故事与描述实际规格的功能/技术设计文档之间存在脱节。

更好的做法是为特性配备一组功能和非功能性需求，使其成为具有自己身份的独立对象。在大多数工具中，可以将需求链接到特性。定义技术设计要求的故事也是如此。



10.4.3 测试案例

必须将功能要求和技术要求与测试案例联系起来，以确保根据项目拥有者的意图（特性）和技术（故事）要求来实现。

10.4.4 可追溯性

DevOps提供从需求到部署的快速反馈周期。 服务中断必须尽快与新的或变更的要求（向后追溯）相联系。 但是新的或变更的要求对已经部署的功能的影响也是最重要的（向前追溯）。

为了实现这两种形式的可追溯性，从主题到生产中的配置项（CI）都必须有良好的对象注册。 在图1中，绘制了一个对象模型和它们之间的关系。 在选择DevOps工具时（参阅文章＃05），注意哪些工具包含哪些对象以及如何将它们链接到必要的位置非常重要。

DevOps-Best-Practices-Xu-Feng/pics/Chapter_10_cn/图10-1 从漏斗架构到故事看板.png

图10-1，从漏斗架构到故事看板

可追溯性从主题开始，一个主题包括一个或多个史诗。上述情况也适用于史诗和特性关系。原因在于特性可以按功能被划分为几个片断，它将会在这里构建有用的1对n的关系表。由于一个特性会被描述成业务术语，软件的配置项（S-CI）和功能之间的关系最为明显。

特性和需求也是1对多的比例。需求也许是临时的，仅适用于功能实现（动态）或持续的周期，并且对于功能的整个生命周期（静态）都是必需的 。静态需求使用回归测试案件，动态的需求使用普通测试案例。

服务配置项由一个或是多个应用配置项和工具配置项组成。总之，这是一个将服务划分为技术组件的服务模型。为了保持这个图片的可读性，基础架构的配置项被忽略掉了。对象的部署最好以固定的速度进行。这就是为什么将对象部署比喻成非常方便的火车。一个配置项推出后将它放置在一列发布火车上。

服务配置项是否部署在发布版本中，取决于服务配置项的质量。测试取决于各种不同的测试类型（ST，SIT，FAT，PAT，PST）。

ST（系统测试）和SIT（系统集成测试）发生于测试环境。FAT（功能验收测试）、PST（性能测试）和PAT（生产验收测试）在验收环境当中。测试的案例与需求以及对象相关联（应用配置项或是工具配置项）。最终，测试结果同测试用例和测试缺陷结果联系起来。

DevOps-Best-Practices-Xu-Feng/pics/Chapter_10_cn/图10-2 从漏斗架构到故事看板-详细视图.png

图10-2，从漏斗架构到故事看板 - 详细视图

图10-2 是比图10-1显示的更加详细的视图。在这里的的故事都于这些特性相关。另外，测试类型颗粒度低。FAT/PAT和PST都提供一个预先测试需求，这些标志着测试类型并不是真实的 FAT/PAT和PST，但是这些都是早期的可接受的在测试环境当中的测试。

10.4.5 信息债务

一个非常重要的风险是少量机构认为这是一个信息债务。这是在敏捷项目当中的一种现象，导致这种结果的原因是不适当管理在图10-1和图10-2中对象的原数据。

导致这种差距的原因在于工具集在部署管道部署后的几个月内都没有录入原数据在上面运行。同时也由于手工测试或是不完善测试导致。因此，可以解释说明为大部分的DevOps团队当前都在生产遗留物。









